@using System.Globalization
@using System.Threading.Tasks
@using EventPlanner.Models
@using FoursquareVenuesService

@model EventViewModel

@if (Model == null)
{
    Url.Action("Index", "Home", new { CurrentEvent = Model });
}

<h3>Add places and times</h3>

<ul>
    @foreach (var place in Model.Places)
    {
        <li>
            <div class="form-group">

                @* Display place name *@
                @Html.DisplayFor(modelItem => place.Name)

                <ul>
                    @foreach (var time in place.Times)
                    {
                        <li>
                            @* Display time for the place*@
                            @Html.DisplayFor(modelItem => time.Time)
                        </li>
                    }

                    @if (Model.CurrentPlaceFoursquareId != "" && place.FourSquareId == Model.CurrentPlaceFoursquareId)
                    {
                        <li>
                            @* New time*@
                            <form asp-action="AddSingleTime">

                                <label asp-for="CurrentTime"></label>
                                <input class="form-group" asp-for="CurrentTime" type="datetime2" />

                                @* Hidden fields *@
                                <input id="foursquareId" asp-for="CurrentPlaceFoursquareId" type="text" hidden />
                                <input id="eventId" asp-for="EventId" type="number" hidden />

                                @* Add time *@
                                <input type="submit" value="Add time" class="btn btn-primary" />
                            </form>
                        </li>
                    }
                </ul>
            </div>

        </li>
    }
</ul>

@* New Place *@
<form asp-action="AddSinglePlace" form class="form-inline">

    <div class="form-group">
        <label>City: </label>
        <input class="form-control" id="PlaceCity" />
    </div>

    <div class="form-group">
        <label>Place: </label>
        <input class="form-control" id="PlaceName" type="text" />
    </div>

    <div class="form-group">
        <select id="ddlplaces" class="js-data-example-ajax">
            <option value="3620194" selected="selected" style="width: 400px">Search places...</option>
        </select>
    </div>
    
    @* Hidden field *@
    <input id="eventId" asp-for="EventId" type="number" hidden />

    @* Submit button *@
    <input type="submit" value="Add place" class="btn btn-primary" />

</form>

@* Submit form and create the event *@
@if (Model.CurrentPlaceFoursquareId != "")
{
    <form asp-action="ShowCreatedEvent" form class="form-horizontal">

        @* Hidden field *@
        <input id="eventId" asp-for="EventId" type="number" hidden />

        @* Submit button *@
        <input type="submit" value="Finish" class="btn btn-primary" />

    </form>
}


